#!/usr/bin/python
import src.source.use
from src.Logging.print_stdout import print_warning, print_process

class Packet_Sniffing:
    def __init__(self, interfaces):
        self.interfaces = interfaces
        if not self.interfaces:
            print_warning("Please input your interfaces!!")
            src.source.use.sys.exit(1)

    def start_sniff(pkt):
        if src.source.use.IP in pkt:
            ip_src = pkt[src.source.use.IP].src
            ip_dst = pkt[src.source.use.IP].dst
            if pkt.haslayer(src.source.use.DNS) and pkt.getlayer(src.source.use.DNS).qr == 0:
                print_process(str(ip_src) + ' => ' + str(ip_dst) +
                                ': ' + '(' + pkt.getlayer(src.source.use.DNS).qd.name + ')')

    def main(self):
        try:
            src.source.use.sniff(iface=self.interfaces, prn=start_sniff, filter="port udp 53")
            print_warning("Shutting down...")
        except KeyboardInterrupt:
            print_process("Interrupt by user, Exiting...!!")
            exit(0)
