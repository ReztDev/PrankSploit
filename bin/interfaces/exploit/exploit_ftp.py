#!/usr/bin/python
from src.Logging.print_stdout import print_error
from src.banner.color import pycolor_style
from src.process.MainProcess import Process_Shell
from bin.exploit.ftpbrute import FTP_Brute_Force
import bin.interfaces.MainConsole
from bin.interfaces.source.help_interfaces.exploit.help_ftp import showHelpMessage, showOptionsMessage

host = ""
user = ""
wordlist = ""
class Exploit_Ftp_Interfaces(object):
	def __init__(self, commands):
		self.cmd = commands

	def main_exploit(self):
		global host, user, wordlist
		try:
			if self.cmd == "help":
				print(showHelpMessage())

			elif self.cmd == "show options":
				print(showOptionsMessage(host, user, wordlist))

			elif self.cmd == "back":
				bin.interfaces.MainConsole.main_interfaces()

			elif "set HOST" in self.cmd:
				try:
					host = self.cmd.split()[2]
					print("HOST => {}".format(host))
				except IndexError:
					print_error("Required host target!!")

			elif "set USER" in self.cmd:
				try:
					user = self.cmd.split()[2]
					print("USERNAME => {}".format(user))
				except IndexError:
					print_error("Required username!!")

			elif "set WORDLIST" in self.cmd:
				try:
					wordlist = self.cmd.split()[2]
					print("WORDLIST => {}".format(wordlist))
				except IndexError:
					print_error("Required wordlist you!!")

			elif self.cmd == "run":
				if host != "" and user != "" and wordlist != "":
					run = FTP_Brute_Force(host, user, wordlist)
					run.mainBruteForce()
				else:
					print(showOptionsMessage(host, user, wordlist))

			else:
				proc = Process_Shell(self.cmd)
				proc.main_process()
				
		except IOError as error:
			print_error(str(error))

def Main_Interactive_FTP():
	try:
		while True:
			cmd = raw_input("{l1}prsf{l2} exploit({rd1}ftp_brute{rd2}) > ".format(
				l1=pycolor_style.L, l2=pycolor_style.W, rd1=pycolor_style.R, rd2=pycolor_style.W
			))
			ftp = Exploit_Ftp_Interfaces(cmd)
			ftp.main_exploit()
			if cmd == "exit":
				exit(0)
	except KeyboardInterrupt:
		print_error('Interrupt by user, command "exit" to quit!!')
		Main_Interactive_FTP()
	except EOFError:
		import sys
		sys.exit()