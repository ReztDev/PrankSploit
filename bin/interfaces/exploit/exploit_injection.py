#!/usr/bin/python
import src.source.use
import src.Logging.print_stdout
import src.process.MainProcess
import bin.interfaces.MainConsole
from src.banner.color import pycolor_style
import bin.interfaces.source.exploit.modules_exploit

host_target = ""

class Exploit_Injection(object):
    def __init__(self, command):
        self.cmd = command

    def main_exploit(self):
        global host_target
        try:
            if self.cmd == "help":
                pass

            elif self.cmd == "show options":
                pass

            elif self.cmd == "back":
                bin.interfaces.MainConsole.main_interfaces()

            elif "set RHOST" in self.cmd:
                try:
                    host_target = self.cmd.split()[2]
                    print("RHOST => {}".format(host_target))
                except IndexError:
                    src.Logging.print_stdout.print_error(
                        "Required specify url!!"
                    )
                    src.Logging.print_stdout.print_error(
                        "Example: http://target-site.com/index.php?id=xx"
                    )

            elif self.cmd == "run":
                if host_target != "":
                    print
                    buff = bin.interfaces.source.exploit.modules_exploit.Injection_Username_Password(host_target)
                    buff.main_injection()
                else:
                    pass

            else:
                process = src.process.MainProcess.Process_Shell(self.cmd)
                process.main_process()

        except:
            pass

def Main_Interactive_Injection():
    try:
        while True:
            cmd = raw_input(
                "{ln1}prsf{ln2} exploit({rd1}injection_user_passwd{rd2}) > ".format(
                    ln1=pycolor_style.L,
                    ln2=pycolor_style.W,
                    rd1=pycolor_style.R,
                    rd2=pycolor_style.W
                )
            )
            exploit = Exploit_Injection(cmd)
            exploit.main_exploit()
            if cmd == "exit":
                src.source.use.sys.exit()
    except KeyboardInterrupt:
        src.Logging.print_stdout.print_error(
            'Interrupt by user, command "exit" to quit!!'
        )
        Main_Interactive_Injection()